<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>LoggingEventSelectionStrategyDecorator.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bp-ide-bpjs-bp-framework</a> &gt; <a href="index.source.html" class="el_package">il.ac.bgu.cs.bp.bpjs.model.eventselection</a> &gt; <span class="el_source">LoggingEventSelectionStrategyDecorator.java</span></div><h1>LoggingEventSelectionStrategyDecorator.java</h1><pre class="source lang-java linenums">/*
 * The MIT License
 *
 * Copyright 2017 BGU.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the &quot;Software&quot;), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
package il.ac.bgu.cs.bp.bpjs.model.eventselection;

import il.ac.bgu.cs.bp.bpjs.model.BEvent;
import il.ac.bgu.cs.bp.bpjs.model.BProgramSyncSnapshot;
import java.io.PrintStream;
import java.io.PrintWriter;
import java.util.Optional;
import java.util.Set;

/**
 * A decorator that logs the state of the BProgram prior to letting the 
 * decorated {@link EventSelectionStrategy} select the event.Logging is done to a {@link PrintStream}, which defaults to {@code System.out}.
 *  
 * @param &lt;ESS&gt; The type of event selection strategy being decorated.
 * 
 * @author michael
 */
public class LoggingEventSelectionStrategyDecorator&lt;ESS extends EventSelectionStrategy&gt; extends AbstractEventSelectionStrategyDecorator&lt;ESS&gt; {
    
    private final PrintWriter out;
    
    public LoggingEventSelectionStrategyDecorator(ESS decorated, PrintWriter anOut) {
<span class="fc" id="L46">        super(decorated);</span>
<span class="fc" id="L47">        out = anOut;</span>
<span class="fc" id="L48">    }</span>
    
    public LoggingEventSelectionStrategyDecorator(ESS decorated) {
<span class="nc" id="L51">        this(decorated, new PrintWriter(System.out));</span>
<span class="nc" id="L52">    }</span>

    @Override
    public Set&lt;BEvent&gt; selectableEvents(BProgramSyncSnapshot bpss) {
<span class="fc" id="L56">        final Set&lt;BEvent&gt; selectableEvents = getDecorated().selectableEvents(bpss);</span>

<span class="fc" id="L58">        out.println(&quot;== Choosing Selectable Events ==&quot;);</span>
<span class="fc" id="L59">        out.println(&quot;BThread Sync Statements:&quot;);</span>
<span class="fc" id="L60">        bpss.getStatements().forEach( stmt -&gt; {</span>
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">            out.println(&quot;+ &quot; + stmt.getBthread().getName() + &quot;:&quot; + (stmt.isHot()?&quot; HOT&quot;:&quot;&quot;));</span>
<span class="fc" id="L62">            out.println(&quot;    Request: &quot; + stmt.getRequest());</span>
<span class="fc" id="L63">            out.println(&quot;    WaitFor: &quot; + stmt.getWaitFor());</span>
<span class="fc" id="L64">            out.println(&quot;    Block: &quot;   + stmt.getBlock());</span>
<span class="fc" id="L65">            out.println(&quot;    Interrupt: &quot; + stmt.getInterrupt());</span>
<span class="fc" id="L66">        });</span>
<span class="fc" id="L67">        out.println(&quot;+ ExternalEvents: &quot; + bpss.getExternalEvents());</span>
        
<span class="fc" id="L69">        out.println(&quot;-- Selectable Events -----------&quot;);</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if ( selectableEvents.isEmpty() ){</span>
<span class="nc" id="L71">            out.println(&quot; - none -&quot;);</span>
        } else {
<span class="fc" id="L73">            selectableEvents.stream().forEach( e -&gt; out.println(&quot; + &quot; + e));</span>
        }
<span class="fc" id="L75">        out.println(&quot;================================&quot;);</span>
<span class="fc" id="L76">        out.flush();</span>

<span class="fc" id="L78">        return selectableEvents;</span>
    }

    @Override
    public Optional&lt;EventSelectionResult&gt; select(BProgramSyncSnapshot bpss, Set&lt;BEvent&gt; selectableEvents) {
<span class="fc" id="L83">        Optional&lt;EventSelectionResult&gt; selectedEvent = getDecorated().select(bpss, selectableEvents);</span>
<span class="fc" id="L84">        out.println(&quot;== Actual Event Selection ======&quot;);</span>
<span class="fc" id="L85">        out.println( selectedEvent.toString() );</span>
<span class="fc" id="L86">        out.println(&quot;================================&quot;);</span>
<span class="fc" id="L87">        out.flush();</span>
<span class="fc" id="L88">        return selectedEvent;</span>
    }
    
    
    
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>