<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BPJsDebuggerCliRunner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bp-ide-bpjs-debugger</a> &gt; <a href="index.source.html" class="el_package">il.ac.bgu.se.bp.mains</a> &gt; <span class="el_source">BPJsDebuggerCliRunner.java</span></div><h1>BPJsDebuggerCliRunner.java</h1><pre class="source lang-java linenums">package il.ac.bgu.se.bp.mains;

import il.ac.bgu.se.bp.debugger.BPJsDebugger;
import il.ac.bgu.se.bp.debugger.state.BPDebuggerState;
import il.ac.bgu.se.bp.execution.BPJsDebuggerImpl;
import il.ac.bgu.se.bp.rest.response.BooleanResponse;
import il.ac.bgu.se.bp.rest.response.GetSyncSnapshotsResponse;

import java.util.Collections;
import java.util.Scanner;
import java.util.concurrent.Callable;
import java.util.function.Function;

<span class="nc" id="L14">public class BPJsDebuggerCliRunner {</span>

<span class="nc" id="L16">    private static boolean isTerminated = false;</span>
    private static BPJsDebugger&lt;BooleanResponse&gt; bpJsDebugger;
<span class="nc" id="L18">    private static Scanner sc = new Scanner(System.in);</span>
<span class="nc" id="L19">    private static boolean isSkipSyncPoints = false;</span>
<span class="nc" id="L20">    private static boolean isSkipBreakPoints = false;</span>

    public static void main(String[] args) {
<span class="nc" id="L23">        final String filename = &quot;BPJSDebuggerTest.js&quot;;</span>
//        final String filename = &quot;BPJSDebuggerRecTest.js&quot;;

<span class="nc" id="L26">        Function&lt;BPDebuggerState, Void&gt; onStateChangedEvent = BPJsDebuggerCliRunner::onStateChanged;</span>
<span class="nc" id="L27">        sc = new Scanner(System.in);</span>
<span class="nc" id="L28">        bpJsDebugger = new BPJsDebuggerImpl(filename, createOnExitCallback(sc), onStateChangedEvent);</span>
<span class="nc" id="L29">        runBPJsDebuggerCliRunner();</span>

<span class="nc" id="L31">        System.out.println(&quot;BPJsDebuggerCliRunner exiting..&quot;);</span>
<span class="nc" id="L32">    }</span>

    private static Void onStateChanged(BPDebuggerState state) {
<span class="nc" id="L35">        System.out.println(state.toString());</span>
<span class="nc" id="L36">        return null;</span>
    }

    private static void runBPJsDebuggerCliRunner() {
<span class="nc bnc" id="L40" title="All 2 branches missed.">        while (!isTerminated) {</span>
<span class="nc bnc" id="L41" title="All 2 branches missed.">            boolean isStop = !userMenuLoop(sc, bpJsDebugger);</span>
<span class="nc bnc" id="L42" title="All 4 branches missed.">            isTerminated = isTerminated || isStop;</span>
<span class="nc" id="L43">        }</span>
<span class="nc" id="L44">        bpJsDebugger.stop();</span>
<span class="nc" id="L45">    }</span>

    private static boolean userMenuLoop(Scanner sc, BPJsDebugger&lt;BooleanResponse&gt; bpJsDebugger) {
<span class="nc" id="L48">        String[] splat = getUserInput(sc);</span>
<span class="nc" id="L49">        String cmd = splat[0];</span>
<span class="nc bnc" id="L50" title="All 18 branches missed.">        switch (cmd) {</span>
            case &quot;b&quot;:
<span class="nc bnc" id="L52" title="All 2 branches missed.">                if (!bpJsDebugger.isSetup()) {</span>
<span class="nc" id="L53">                    sendRequest(() -&gt; bpJsDebugger.setup(</span>
<span class="nc" id="L54">                            Collections.singletonMap(Integer.parseInt(splat[1]), true),</span>
                            isSkipSyncPoints));
                }
                else
<span class="nc" id="L58">                    sendRequest(() -&gt; bpJsDebugger.setBreakpoint(</span>
<span class="nc" id="L59">                            Integer.parseInt(splat[1]),</span>
                            true));
<span class="nc" id="L61">                break;</span>
            case &quot;rb&quot;:
<span class="nc bnc" id="L63" title="All 4 branches missed.">                if (!bpJsDebugger.isSetup() || !bpJsDebugger.isStarted()) {</span>
<span class="nc" id="L64">                    sendRequest(() -&gt; bpJsDebugger.setup(</span>
<span class="nc" id="L65">                            Collections.singletonMap(Integer.parseInt(splat[1]), false),</span>
                            isSkipSyncPoints));
                }
                else
<span class="nc" id="L69">                    sendRequest(() -&gt; bpJsDebugger.setBreakpoint(Integer.parseInt(splat[1]), false));</span>
<span class="nc" id="L70">                break;</span>
            case &quot;go&quot;:
<span class="nc bnc" id="L72" title="All 2 branches missed.">                if (!bpJsDebugger.isStarted()) {</span>
<span class="nc" id="L73">                    sendRequest(() -&gt; bpJsDebugger.startSync(isSkipSyncPoints));</span>
                }
                else {
<span class="nc" id="L76">                    sendRequest(bpJsDebugger::continueRun);</span>
                }
<span class="nc" id="L78">                break;</span>
            case &quot;si&quot;:
<span class="nc" id="L80">                sendRequest(bpJsDebugger::stepInto);</span>
<span class="nc" id="L81">                break;</span>
            case &quot;sov&quot;:
<span class="nc" id="L83">                sendRequest(bpJsDebugger::stepOver);</span>
<span class="nc" id="L84">                break;</span>
            case &quot;sou&quot;:
<span class="nc" id="L86">                sendRequest(bpJsDebugger::stepOut);</span>
<span class="nc" id="L87">                break;</span>
            case &quot;tmb&quot;:
<span class="nc bnc" id="L89" title="All 2 branches missed.">                isSkipBreakPoints = !isSkipBreakPoints;</span>
<span class="nc" id="L90">                sendRequest(() -&gt; bpJsDebugger.toggleMuteBreakpoints(isSkipBreakPoints));</span>
<span class="nc" id="L91">                break;</span>
            case &quot;n&quot;:
<span class="nc" id="L93">                sendRequest(bpJsDebugger::nextSync);</span>
<span class="nc" id="L94">                break;</span>
            case &quot;e&quot;: {
<span class="nc bnc" id="L96" title="All 2 branches missed.">                if (splat.length != 2) {</span>
<span class="nc" id="L97">                    System.out.println(&quot;must enter event&quot;);</span>
<span class="nc" id="L98">                    break;</span>
                }
<span class="nc" id="L100">                sendRequest(() -&gt; bpJsDebugger.addExternalEvent(splat[1]));</span>
<span class="nc" id="L101">                break;</span>
            }
            case &quot;re&quot;: {
<span class="nc bnc" id="L104" title="All 2 branches missed.">                if (splat.length != 2) {</span>
<span class="nc" id="L105">                    System.out.println(&quot;must enter event&quot;);</span>
<span class="nc" id="L106">                    break;</span>
                }
<span class="nc" id="L108">                sendRequest(() -&gt; bpJsDebugger.removeExternalEvent(splat[1]));</span>
<span class="nc" id="L109">                break;</span>
            }
            case &quot;we&quot;: {
<span class="nc bnc" id="L112" title="All 2 branches missed.">                if (splat.length != 2) {</span>
<span class="nc" id="L113">                    System.out.println(&quot;must enter event&quot;);</span>
<span class="nc" id="L114">                    break;</span>
                }
<span class="nc bnc" id="L116" title="All 2 branches missed.">                boolean shouldWait = Integer.parseInt(splat[1]) &gt; 0;</span>
<span class="nc" id="L117">                sendRequest(() -&gt; bpJsDebugger.setWaitForExternalEvents(shouldWait));</span>
<span class="nc" id="L118">                break;</span>
            }
            case &quot;h&quot;: {
<span class="nc" id="L121">                System.out.println(&quot;go - start the program \n&quot; +</span>
                        &quot;n - next sync state \n&quot; +
                        &quot;e &lt;event name&gt;- add external event+ &quot; +
                        &quot;re &lt;event name&gt; - remove external event&quot; +
                        &quot;we &lt;0/1&gt;- wait for external events &quot; +
                        &quot;&quot;);
            }
            case &quot;tsp&quot;:
<span class="nc bnc" id="L129" title="All 2 branches missed.">                isSkipSyncPoints = !isSkipSyncPoints;</span>
<span class="nc" id="L130">                sendRequest(() -&gt; bpJsDebugger.setIsSkipSyncPoints(isSkipSyncPoints));</span>
<span class="nc" id="L131">                break;</span>
            case &quot;getss&quot;:
<span class="nc" id="L133">                sendGetSyncSnapshotsResponse(bpJsDebugger::getSyncSnapshotsHistory);</span>
<span class="nc" id="L134">                break;</span>
            case &quot;sss&quot;:  // set syncsnapshot
<span class="nc" id="L136">                sendRequest(() -&gt; bpJsDebugger.setSyncSnapshots(Long.parseLong(splat[1])));</span>
<span class="nc" id="L137">                break;</span>
            case &quot;stop&quot;:
<span class="nc" id="L139">                sendRequest(bpJsDebugger::stop);</span>
<span class="nc" id="L140">                break;</span>
            case &quot;gets&quot;:
<span class="nc" id="L142">                sendRequest(bpJsDebugger::getState);</span>
                break;
        }
<span class="nc bnc" id="L145" title="All 2 branches missed.">        return !cmd.equals(&quot;stop&quot;);</span>
    }

    private static void sendRequest(Callable&lt;BooleanResponse&gt; callable) {
        try {
<span class="nc" id="L150">            BooleanResponse booleanResponse = callable.call();</span>
<span class="nc bnc" id="L151" title="All 2 branches missed.">            if (!booleanResponse.isSuccess()) {</span>
<span class="nc" id="L152">                System.out.println(&quot;booleanResponse.getErrorCode: &quot; + booleanResponse.getErrorCode());</span>
            }
            else {
<span class="nc" id="L155">                System.out.println(&quot;request sent successfully&quot;);</span>
            }
<span class="nc" id="L157">        } catch (Exception e) {</span>
<span class="nc" id="L158">            e.printStackTrace();</span>
<span class="nc" id="L159">        }</span>
<span class="nc" id="L160">    }</span>

    private static void sendGetSyncSnapshotsResponse(Callable&lt;GetSyncSnapshotsResponse&gt; callable) {
        try {
<span class="nc" id="L164">            GetSyncSnapshotsResponse getSyncSnapshotsResponse = callable.call();</span>
<span class="nc" id="L165">            System.out.println(getSyncSnapshotsResponse.toString());</span>
<span class="nc" id="L166">        } catch (Exception e) {</span>
<span class="nc" id="L167">            e.printStackTrace();</span>
<span class="nc" id="L168">        }</span>
<span class="nc" id="L169">    }</span>


    private static Callable&lt;Boolean&gt; createOnExitCallback(Scanner sc) {
<span class="nc" id="L173">        return () -&gt; {</span>
<span class="nc" id="L174">            isTerminated = true;</span>
<span class="nc" id="L175">            return true;</span>
        };
    }

    private static String[] getUserInput(Scanner sc) {
        try {
<span class="nc" id="L181">            System.out.println(&quot;Enter command: b / rb / go / si / sov / sou / getss / n / e / re / we / h / tmb / tsp / sss / stop&quot;);</span>
<span class="nc" id="L182">            String cmd = sc.nextLine();</span>
<span class="nc" id="L183">            return cmd.split(&quot; &quot;);</span>
<span class="nc" id="L184">        } catch (Exception e) {</span>
<span class="nc" id="L185">            return new String[]{&quot;stop&quot;};</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>